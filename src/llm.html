<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Israel's Soccer Team's Store</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="auth_cart.js"></script>
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <img src="../icons/flag.png" alt="Israeli Flag" class="flag-icon">
            <span>Israel's Soccer Team's Store</span>
        </div>
        <div class="header-right">
            <span id="user-greeting" class="user-greeting"></span>
            <a href="login.html" class="icon login-icon" id="auth-link">
                <span class="tooltip">Log in</span>
            </a>
            <div class="icon cart-icon" id="cart-icon">
                <span>0</span> <!-- Cart item count -->
                <span class="tooltip">View your cart</span>
            </div>
            <div class="icon menu-icon" id="menu-icon">
                <span class="tooltip">Open menu</span>
            </div>
        </div>
    </header>

    <nav id="navigation-menu" class="navigation-menu panel">
        <ul>
            <li><a href="login.html">Login</a></li>
            <li><a href="store.html">Store</a></li>
            <li><a href="tickets.html">Tickets</a></li>
            <li><a href="news.html">News</a></li>
            <li><a href="contact.html">Contact us</a></li>
            <li><a href="readme.html">Readme</a></li>
            <li><a href="llm.html">LLM</a></li>
            <li><a href="admin.html">Admin</a></li>
        </ul>
    </nav>

    <!-- Sliding Cart Window -->
    <div id="cart" class="cartTab panel">
        <div class="cart-header">
            <h2>Your Cart</h2>
        </div>
        <button id="clear-cart" class="clear-cart">Clear cart</button>
        <div id="cart-items" class="cart-items">
            <!-- Cart items will be dynamically loaded here -->
        </div>
        <div class="cart-footer">
            <button id="close-cart" class="close-cart">&times;</button>
            <button id="checkout" class="checkout-button">Checkout</button>
        </div>
    </div>

    <div id="overlay" class="overlay"></div>

    <div class="form-container selection-step readme" style="width: 1000px;">
        <h2>LLM Overview</h2>
        <div class="news-scroller readme">
            <h3>Specify all the code that LLM generated for you</h3>
            <p>All of our code was written with LLM, save for /readme.html and /llm.html.<br>
                The working process was as follows:
                <ul>
                    <li>Writing a prompt for a needed code</li>
                    <li>Implement the code received by the LLM (GPT and/or Claude)</li>
                    <li>First manual check</li>
                    <ul>
                        <li>The code works? -> Next task</li>
                        <li>The code doesn't work? -> Add a prompt to the LLM describing the problem</li>
                        <ul>
                            <li>If after a few tries the LLM could not solve - solve manually</li>
                        </ul>
                    </ul>
                </ul>
            </p>
            <h3>LLM Usage - Partial Example (Claude 3.5)</h3>
            <p>This is an example of the working process, with the two starting prompts as part of the development of /tests/test.js:
                <ul>
                    <li>Prompt: suggest a test in test.js that tests all of the routes in cart-server.js in a logical order.</li>
                    <li>Answer: Claude 3.5 Sonnet<br>
                        Certainly! I can suggest a comprehensive test function that covers all the routes in cart-server.js in a logical order. Here's a new test function you can add to the test.js file:<br>
                        async function testCartRoutes() {<br>
                            console.log('Testing cart routes...');<br>
                            <br>
                            // Ensure the user is logged in<br>
                            await reLogin();<br>
                            <br>
                            // Test 1: View an empty cart<br>
                            let response = await fetch(`${baseUrl}/cart/view`, {<br>
                                method: 'GET',<br>
                                headers: { 'Cookie': `token=${authToken}` }<br>
                            });<br>
                            let data = await response.json();<br>
                            console.log('Test 1: View empty cart -', response.status === 200 && data.length === 0 ? 'Passed' : 'Failed');<br>
                            <br>
                            // Test 2: Add an item to the cart<br>
                            response = await fetch(`${baseUrl}/cart/add-to-cart`, {<br>
                                method: 'POST',<br>
                                headers: { <br>
                                    'Content-Type': 'application/json',<br>
                                    'Cookie': `token=${authToken}` <br>
                                },<br>
                                body: JSON.stringify({ productId: 1 })<br>
                            });<br>
                            data = await response.json();<br>
                            console.log('Test 2: Add item to cart -', response.status === 201 && data.cartItems.length > 0 ? 'Passed' : 'Failed');<br>
                            <br>
                            // Test 3: View the cart with the added item<br>
                            response = await fetch(`${baseUrl}/cart/view`, {<br>
                                method: 'GET',<br>
                                headers: { 'Cookie': `token=${authToken}` }<br>
                            });<br>
                            data = await response.json();<br>
                            console.log('Test 3: View cart with item -', response.status === 200 && data.length > 0 ? 'Passed' : 'Failed');<br>
                            <br>
                            // Test 4: Remove an item from the cart<br>
                            response = await fetch(`${baseUrl}/cart/remove`, {<br>
                                method: 'POST',<br>
                                headers: { <br>
                                    'Content-Type': 'application/json',<br>
                                    'Cookie': `token=${authToken}` <br>
                                },<br>
                                body: JSON.stringify({ productId: 1 })<br>
                            });<br>
                            data = await response.json();<br>
                            console.log('Test 4: Remove item from cart -', response.status === 200 && data.cartItems.length === 0 ? 'Passed' : 'Failed');<br>
                            <br>
                            // Test 5: Add multiple items to the cart<br>
                            await fetch(`${baseUrl}/cart/add-to-cart`, {<br>
                                method: 'POST',<br>
                                headers: { <br>
                                    'Content-Type': 'application/json',<br>
                                    'Cookie': `token=${authToken}` <br>
                                },<br>
                                body: JSON.stringify({ productId: 1 })<br>
                            });<br>
                            await fetch(`${baseUrl}/cart/add-to-cart`, {<br>
                                method: 'POST',<br>
                                headers: { <br>
                                    'Content-Type': 'application/json',<br>
                                    'Cookie': `token=${authToken}` <br>
                                },<br>
                                body: JSON.stringify({ productId: 2 })<br>
                            });<br>
                            <br>
                            // Test 6: Complete purchase<br>
                            response = await fetch(`${baseUrl}/cart/complete-purchase`, {<br>
                                method: 'POST',<br>
                                headers: { 'Cookie': `token=${authToken}` }<br>
                            });<br>
                            data = await response.json();<br>
                            console.log('Test 6: Complete purchase -', response.status === 200 && data.message === 'Purchase completed successfully' ? 'Passed' : 'Failed');<br>
                            <br>
                            // Test 7: View empty cart after purchase<br>
                            response = await fetch(`${baseUrl}/cart/view`, {<br>
                                method: 'GET',<br>
                                headers: { 'Cookie': `token=${authToken}` }<br>
                            });<br>
                            data = await response.json();<br>
                            console.log('Test 7: View empty cart after purchase -', response.status === 200 && data.length === 0 ? 'Passed' : 'Failed');<br>
                            <br>
                            console.log('Cart routes tests completed.');<br>
                        }<br>
                        <br>
                        This test function covers all the routes in cart-server.js in a logical order:<br>
                        <br>
                        View an empty cart<br>
                        Add an item to the cart<br>
                        View the cart with the added item<br>
                        Remove an item from the cart<br>
                        Add multiple items to the cart<br>
                        Complete a purchase<br>
                        View the empty cart after purchase<br>
                        To use this test function, you should add it to your test.js file and call it within the runTests() function, like this:<br>
                        <br>
                        async function runTests() {<br>
                            // ... existing tests ...<br>
                            await testCartRoutes();<br>
                            // ... other tests ...<br>
                        }<br>
                        This comprehensive test will ensure that all cart-related functionality is working as expected.<br></li>
                        <li>Prompt: it does not test the /removeAll route, please add it </li>
                        <li>You're absolutely right. Let's add a test for the /removeAll route to make the test suite even more comprehensive. Here's an updated version of the testCartRoutes function that includes testing the /removeAll route:<br>
                            <br>
                            async function testCartRoutes() {<br>
                                console.log('Testing cart routes...');<br>
                                <br>
                                // Ensure the user is logged in<br>
                                await reLogin();<br>
                                <br>
                                // ... (previous tests remain the same)<br>
                                <br>
                                // Test 8: Add multiple items to the cart again<br>
                                await fetch(`${baseUrl}/cart/add-to-cart`, {<br>
                                    method: 'POST',<br>
                                    headers: { <br>
                                        'Content-Type': 'application/json',<br>
                                        'Cookie': `token=${authToken}` <br>
                                    },<br>
                                    body: JSON.stringify({ productId: 1 })<br>
                                });<br>
                                await fetch(`${baseUrl}/cart/add-to-cart`, {<br>
                                    method: 'POST',<br>
                                    headers: { <br>
                                        'Content-Type': 'application/json',<br>
                                        'Cookie': `token=${authToken}` <br>
                                    },<br>
                                    body: JSON.stringify({ productId: 2 })<br>
                                });<br>
                                <br>
                                // Test 9: Remove all items from the cart<br>
                                response = await fetch(`${baseUrl}/cart/removeAll`, {<br>
                                    method: 'POST',<br>
                                    headers: { 'Cookie': `token=${authToken}` }<br>
                                });<br>
                                data = await response.json();<br>
                                console.log('Test 9: Remove all items from cart -', response.status === 200 && data.cartItems.length === 0 ? 'Passed' : 'Failed');<br>
                                <br>
                                // Test 10: View empty cart after removing all items<br>
                                response = await fetch(`${baseUrl}/cart/view`, {<br>
                                    method: 'GET',<br>
                                    headers: { 'Cookie': `token=${authToken}` }<br>
                                });<br>
                                data = await response.json();<br>
                                console.log('Test 10: View empty cart after removing all items -', response.status === 200 && data.length === 0 ? 'Passed' : 'Failed');<br>
                                <br>
                                console.log('Cart routes tests completed.');<br>
                            }<br>
                            <br>
                            This updated version adds two new tests:<br>
                            <br>
                            Remove all items from the cart using the /removeAll route<br>
                            View the cart to confirm it's empty after removing all items<br>
                            These additional tests ensure that the /removeAll route is functioning correctly. The test suite now covers all routes in cart-server.js, providing a thorough check of the cart functionality.</li>
                </ul>
            </p>
            <h3>Conversation with ChatGPT (August 2024)</h3>
            <p>
                You: I'm building a shop using JS. Let's work together.
            </p>
            <p>
                ChatGPT: Great! What kind of shop are you building, and how can I assist you with it?
            </p>
            <p>
                You: Here are some requirements for my project. Remember them along the work: Additional requirements and allowances:
                <ul>
                    <li>You can use any npm package you need.</li>
                    <li>You must work with cookies to implement user management.</li>
                    <li>You must implement the server side of different screens (register, login, add to cart, products, etc.) in different Node.js files/modules.</li>
                    <li>Implement data persistence in a separate module. Call it persist.js.</li>
                    <li>Utilize async/await as much as possible.</li>
                    <li>Use the most suitable HTTP method (GET, POST, PUT, DELETE).</li>
                    <li>Handle any kind of error, exception, and async errors.</li>
                </ul>
            </p>
            <p>
                ChatGPT: Got it! I've noted down all your requirements. How would you like to start, or is there a specific area where you need help first?
            </p>
            <p>
                You: Build it first: Register screen - user must log in to see any other page (excluding readme, products, and the login/register screens).
            </p>
            <p>
                ChatGPT: Let's start by outlining the server-side code for handling user registration and login using Node.js. We will also set up the necessary route guards to ensure that users must be logged in to access certain pages.
                <br>Step 1: Setup Node.js Environment
                <br>1. Initialize a new Node.js project:
                <ul>
                    <li>mkdir my-shop</li>
                    <li>cd my-shop</li>
                    <li>npm init -y</li>
                </ul>
                <br>2. Install necessary packages:
                <ul>
                    <li>express for the server.</li>
                    <li>bcrypt for hashing passwords.</li>
                    <li>cookie-parser for handling cookies.</li>
                    <li>jsonwebtoken (JWT) for session management.</li>
                </ul>
                <br>3. Install dependencies:
                <ul>
                    <li>npm install express bcrypt cookie-parser jsonwebtoken</li>
                </ul>
                <br>Step 2: Create the Server Structure
                <br>Create the necessary files for the project:
                <ul>
                    <li>touch server.js register-server.js login-server.js persist.js</li>
                </ul>
                <br>Step 3: Implement persist.js for Data Persistence
                <br>Here’s a simple persist.js to simulate a database using JSON files:
                <pre><code>
                    const fs = require('fs');
                    const path = require('path');

                    const USERS_FILE = path.join(__dirname, 'users.json');

                    async function saveUser(user) {
                        const users = await getUsers();
                        users.push(user);
                        return fs.promises.writeFile(USERS_FILE, JSON.stringify(users));
                    }

                    async function getUsers() {
                        try {
                            const data = await fs.promises.readFile(USERS_FILE);
                            return JSON.parse(data);
                        } catch (error) {
                            return [];
                        }
                    }

                    async function findUserByEmail(email) {
                        const users = await getUsers();
                        return users.find(user => user.email === email);
                    }

                    module.exports = { saveUser, getUsers, findUserByEmail };
                </code></pre>
                <br>Step 4: Implement register-server.js
                <pre><code>
                    const express = require('express');
                    const router = express.Router();
                    const bcrypt = require('bcrypt');
                    const { saveUser, findUserByEmail } = require('./persist');

                    router.post('/register', async (req, res) => {
                        try {
                            const { email, password } = req.body;
                            if (!email || !password) {
                                return res.status(400).send({ message: 'Email and password are required.' });
                            }

                            const existingUser = await findUserByEmail(email);
                            if (existingUser) {
                                return res.status(409).send({ message: 'Email already in use.' });
                            }

                            const hashedPassword = await bcrypt.hash(password, 10);
                            await saveUser({ email, password: hashedPassword });
                            res.status(201).send({ message: 'User registered successfully.' });
                        } catch (error) {
                            res.status(500).send({ message: 'Internal server error' });
                        }
                    });

                    module.exports = router;
                </code></pre>
                <br>Step 5: Setup server.js
                <pre><code>
                    const express = require('express');
                    const cookieParser = require('cookie-parser');
                    const registerRouter = require('./register-server');

                    const app = express();
                    app.use(express.json());
                    app.use(cookieParser());
                    app.use('/api', registerRouter);

                    app.listen(3000, () => {
                        console.log('Server running on http://localhost:3000');
                    });
                </code></pre>
                <br>Step 6: Handle Protected Routes
                <br>For routes that require login, you will check the JWT in the cookie. If the token is valid, the user can access the route; if not, they are redirected or receive an error message.
                <br>With these steps, you have a registration screen and the foundational structure to add more screens and functionalities. Next, would you like to implement the login functionality or work on another part of the project?
            </p>
            <p>
                This is a detailed overview of our work process and the implementation steps we took with the assistance of ChatGPT to develop the project.
            </p>
        </div>
    </div>
</body>
</html>
